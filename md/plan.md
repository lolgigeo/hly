# 章节处理执行计划（11-100章）

## 项目概述

基于`md/sop.md`标准操作程序，继续完成第11-100章的校对和Markdown生成工作。每批处理10个章节，确保格式一致性和内容完整性。

## 当前进度

### 已完成章节
- ✅ 第01-10章：已完成格式校对和Markdown生成
- ✅ 参考标准：第01、02章作为格式标准参考

### 待处理章节
- ✅ 第11-100章：共90个章节（其中7个缺失章节已生成占位文件）**已完成**

### 缺失章节
根据`chapters_config.json`，以下章节在原文档中缺失：
- 第17章
- 第22章
- 第23章
- 第32章
- 第88章
- 第90章
- 第91章

**处理方式**：为缺失章节生成占位文件，内容为"本章节在原文档中缺失。"，状态标记为`skipped`。

## 处理批次安排

### 批次划分（每批10个章节）

| 批次 | 章节范围 | 章节列表 | 状态 |
|------|---------|---------|------|
| 批次1 | 11-20 | 11, 12, 13, 14, 15, 16, **17(缺失)**, 18, 19, 20 | ✅ 已完成 |
| 批次2 | 21-30 | 21, **22(缺失)**, **23(缺失)**, 24, 25, 26, 27, 28, 29, 30 | ✅ 已完成 |
| 批次3 | 31-40 | 31, **32(缺失)**, 33, 34, 35, 36, 37, 38, 39, 40 | ✅ 已完成 |
| 批次4 | 41-50 | 41, 42, 43, 44, 45, 46, 47, 48, 49, 50 | ✅ 已完成 |
| 批次5 | 51-60 | 51, 52, 53, 54, 55, 56, 57, 58, 59, 60 | ✅ 已完成 |
| 批次6 | 61-70 | 61, 62, 63, 64, 65, 66, 67, 68, 69, 70 | ✅ 已完成 |
| 批次7 | 71-80 | 71, 72, 73, 74, 75, 76, 77, 78, 79, 80 | ✅ 已完成 |
| 批次8 | 81-90 | 81, 82, 83, 84, 85, 86, 87, **88(缺失)**, 89, **90(缺失)** | ✅ 已完成 |
| 批次9 | 91-100 | **91(缺失)**, 92, 93, 94, 95, 96, 97, 98, 99, 100 | ✅ 已完成 |

**总计**：9个批次，90个章节（83个实际章节 + 7个缺失章节）

**✅ 所有批次已完成！** 共生成100个Markdown文件（93个实际章节 + 7个占位文件）

## 处理流程（基于SOP标准）

### 阶段1：准备阶段

#### 1.1 验证原始文件
- [ ] 确认`chapters_raw/`目录下存在所有章节的原始文件
- [ ] 检查缺失章节是否已生成空文件或占位文件
- [ ] 验证文件编码为UTF-8

#### 1.2 准备处理脚本
使用基于SOP标准的处理函数`format_chapter_content_sop`，确保：
- [ ] 移除论坛信息
- [ ] 移除副标题
- [ ] 移除章节标记混入
- [ ] 统一段落格式（段落之间一个空行）
- [ ] 生成标准Markdown格式（`# 第X章`）

### 阶段2：批量处理（每批10个章节）

#### 2.1 处理步骤

对每个批次，执行以下步骤：

1. **批量处理脚本执行**
   ```bash
   # 使用Python脚本批量处理指定范围的章节
   python3 -c "
   from process_chapters_batch import process_chapters_batch
   process_chapters_batch(start_chapter, end_chapter)
   "
   ```
   或使用内联脚本处理指定范围。

2. **质量检查**
   对每个生成的Markdown文件，检查：
   - [ ] 标题格式：`# 第X章`（不补零）
   - [ ] 副标题已移除
   - [ ] 章节标记已清理（无"第XX回"、"第XX章"混入正文）
   - [ ] 论坛信息已清理
   - [ ] 段落格式统一（段落之间一个空行）
   - [ ] 特殊字符已移除（`?`、"窗体底端"等）
   - [ ] 内容完整，无截断

3. **格式对比**
   - 与第01、02章对比，确保格式一致
   - 发现问题及时修正

4. **更新进度**
   - 更新`progress.json`，标记章节状态为`completed`
   - 记录处理时间和备注

#### 2.2 缺失章节处理

对于缺失章节（17, 22, 23, 32, 88, 90, 91），生成占位文件：

```markdown
# 第XX章

本章节在原文档中缺失。
```

状态标记为`skipped`。

### 阶段3：质量保证

#### 3.1 批次完成检查

每完成一个批次（10个章节），进行：
- [ ] 格式一致性检查
- [ ] 内容完整性验证
- [ ] 与参考标准（第01、02章）对比
- [ ] 记录发现的问题和修正措施

#### 3.2 最终验证

所有批次完成后：
- [ ] 验证所有章节文件已生成（100个文件）
- [ ] 检查文件编码（UTF-8）
- [ ] 验证文件命名规范（`第XX章.md`）
- [ ] 生成最终处理报告

## 技术规范（基于SOP）

### 处理函数标准

使用`format_chapter_content_sop`函数，确保：

1. **内容清理**
   - 移除论坛信息：`级别:|发帖:|Posted:|\[.*楼\]|堂中威望|贡献值|注册时间|最后登录|梦中的王子`
   - 移除副标题：`^[^。，！？]*[（(].*?[）)]$`（长度 < 50）
   - 处理副标题与正文同行：`^([^。，！？]*[（(].*?[）)])\s+(.+)$`
   - 移除章节标记混入：`第[0-9一二三四五六七八九十百]+[回章]\s*`

2. **段落格式化**
   - 按句号、问号、感叹号分割
   - 智能合并段落（当前段落长度 > 100字符，下一句长度 > 20字符时开始新段落）
   - 段落之间一个空行

3. **Markdown生成**
   - 标题格式：`# 第X章`（X为阿拉伯数字，不补零）
   - 标题后空一行
   - 段落之间空一行

### 文件命名规范

- **原始章节**：`chapters_raw/chapter_XX.txt`（补零，如`chapter_11.txt`）
- **最终输出**：`result/第XX章.md`（不补零，如`第11章.md`）

### 编码规范

- **输入**：UTF-8编码（`chapters_raw/*.txt`）
- **输出**：UTF-8编码（`result/*.md`）

## 执行命令示例

### 批次1：处理第11-20章

```python
# 使用Python脚本批量处理
for i in range(11, 21):
    process_chapter_sop(i)
```

### 批次2：处理第21-30章

```python
for i in range(21, 31):
    process_chapter_sop(i)
```

### 缺失章节处理

```python
missing_chapters = [17, 22, 23, 32, 88, 90, 91]
for chapter_num in missing_chapters:
    generate_placeholder(chapter_num)
```

## 进度跟踪

### 进度文件格式

`progress.json`格式：

```json
{
  "11": {
    "status": "completed",
    "created_at": "2026-02-06T10:00:00",
    "updated_at": "2026-02-06T10:05:00",
    "notes": "已完成格式校对和Markdown生成"
  },
  "17": {
    "status": "skipped",
    "created_at": "2026-02-06T10:00:00",
    "updated_at": "2026-02-06T10:00:00",
    "notes": "本章节在原文档中缺失"
  }
}
```

### 状态说明

- `pending`：待处理
- `processing`：处理中
- `completed`：已完成
- `skipped`：跳过（缺失章节）

## 质量检查清单（每批完成后）

- [ ] **标题格式**：是否为`# 第X章`格式
- [ ] **副标题移除**：是否已移除所有副标题
- [ ] **章节标记**：正文中是否还有章节标记残留
- [ ] **论坛信息**：是否已清理论坛元数据
- [ ] **段落格式**：段落间距是否统一（一个空行）
- [ ] **特殊字符**：是否已移除`?`、"窗体底端"等
- [ ] **编码正确**：文件是否为UTF-8编码
- [ ] **内容完整**：章节内容是否完整，无截断
- [ ] **格式一致**：与第01、02章格式是否一致

## 常见问题处理

### 问题1：章节内容为空

**处理**：
1. 检查`chapters_raw/chapter_XX.txt`是否存在且不为空
2. 检查处理逻辑是否正确识别章节标记
3. 如确实缺失，生成占位文件

### 问题2：副标题未移除

**处理**：
1. 检查副标题匹配模式是否正确
2. 检查副标题是否与正文在同一行
3. 使用SOP中的正则表达式重新处理

### 问题3：段落格式不一致

**处理**：
1. 检查段落分割逻辑
2. 参考第01、02章的段落格式
3. 调整段落分割参数（当前段落长度 > 100字符，下一句长度 > 20字符）

### 问题4：章节标记混入正文

**处理**：
1. 使用正则表达式：`第[0-9一二三四五六七八九十百]+[回章]\s*`
2. 在合并文本后再次清理
3. 确保所有章节标记已移除

## 预期输出

### 文件结构

```
hly/
├── chapters_raw/             # 原始章节内容（已存在）
│   ├── chapter_11.txt
│   ├── chapter_12.txt
│   └── ...
├── result/                   # 最终输出（部分完成）
│   ├── 第01章.md            # ✅ 已完成
│   ├── 第02章.md            # ✅ 已完成
│   ├── ...
│   ├── 第10章.md            # ✅ 已完成
│   ├── 第11章.md            # 📋 待处理
│   ├── ...
│   ├── 第17章.md            # 📋 缺失章节（占位文件）
│   └── 第100章.md           # 📋 待处理
├── progress.json             # 处理进度记录
└── md/
    ├── plan.md               # 本文档
    └── sop.md                # 标准操作程序
```

### 最终目标

- ✅ 100个Markdown文件（83个实际章节 + 7个占位文件）
- ✅ 所有文件格式统一（基于第01、02章标准）
- ✅ 所有文件编码为UTF-8
- ✅ 所有文件符合Markdown规范

## 执行时间估算

- **每批处理时间**：约30-60分钟（10个章节）
- **质量检查时间**：约10-15分钟/批
- **总预计时间**：约6-9小时（9个批次）

## 注意事项

1. **格式一致性**：严格按照SOP标准处理，确保与第01、02章格式一致
2. **缺失章节**：及时生成占位文件，避免遗漏
3. **进度跟踪**：每完成一批，及时更新`progress.json`
4. **质量检查**：每批完成后进行质量检查，发现问题及时修正
5. **备份**：处理前备份`result/`目录，防止数据丢失

## 附录

### 相关文件

- `md/sop.md` - 标准操作程序（参考文档）
- `chapters_config.json` - 章节配置文件
- `progress.json` - 处理进度文件
- `process_chapters_batch.py` - 批量处理脚本（如存在）

### 参考标准

- 第01章：`result/第01章.md`
- 第02章：`result/第02章.md`

---

**文档版本**：v2.0  
**最后更新**：2026-02-06  
**基于文档**：`md/sop.md`  
**处理范围**：第11-100章（共90个章节）
